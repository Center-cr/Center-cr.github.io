<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>micropython+esp32（更新中） | Center-cr's Blog</title><meta name="author" content="Center-cr"><meta name="copyright" content="Center-cr"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="网络卡顿无法加载图片请访问备用网址 Micropython+esp32 (flowus.cn) 描述 之前做物联网项目使用了 micropython+esp32 ,现在手里刚到了新的板子和一批外设，想过一遍例程 ，再转入espidf深入学习。 教程 it项目网www.itprojects.cn Python+ESP32 快速上手（持续更新中） wifi 蓝牙 智能控制 单片机">
<meta property="og:type" content="article">
<meta property="og:title" content="micropython+esp32（更新中）">
<meta property="og:url" content="http://example.com/2023/07/24/%E5%8D%95%E7%89%87%E6%9C%BA/micropython+esp32/index.html">
<meta property="og:site_name" content="Center-cr&#39;s Blog">
<meta property="og:description" content="网络卡顿无法加载图片请访问备用网址 Micropython+esp32 (flowus.cn) 描述 之前做物联网项目使用了 micropython+esp32 ,现在手里刚到了新的板子和一批外设，想过一遍例程 ，再转入espidf深入学习。 教程 it项目网www.itprojects.cn Python+ESP32 快速上手（持续更新中） wifi 蓝牙 智能控制 单片机">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://raw.githubusercontent.com/Center-cr/picture/main/202307240038038.webp">
<meta property="article:published_time" content="2023-07-23T16:00:00.000Z">
<meta property="article:modified_time" content="2023-07-28T16:00:00.000Z">
<meta property="article:author" content="Center-cr">
<meta property="article:tag" content="esp32">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/Center-cr/picture/main/202307240038038.webp"><link rel="shortcut icon" href="/img/icon.png"><link rel="canonical" href="http://example.com/2023/07/24/%E5%8D%95%E7%89%87%E6%9C%BA/micropython+esp32/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="/pluginsSrc/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="/pluginsSrc/@fancyapps/ui/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: '/pluginsSrc/flickr-justified-gallery/dist/fjGallery.min.js',
      css: '/pluginsSrc/flickr-justified-gallery/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'micropython+esp32（更新中）',
  isPost: true,
  isHome: false,
  isHighlightShrink: true,
  isToc: true,
  postUpdate: '2023-07-29 00:00:00'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/custom.css"  media="defer" onload="this.media='all'"><meta name="generator" content="Hexo 6.3.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/icon.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">101</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">47</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">15</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我</span></a></div><div class="menus_item"><a class="site-page" href="/tools_online/"><i class="fa-fw fas fa-cloud"></i><span> 在线工具</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://raw.githubusercontent.com/Center-cr/picture/main/202307240038038.webp')"><nav id="nav"><span id="blog-info"><a href="/" title="Center-cr's Blog"><span class="site-name">Center-cr's Blog</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我</span></a></div><div class="menus_item"><a class="site-page" href="/tools_online/"><i class="fa-fw fas fa-cloud"></i><span> 在线工具</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">micropython+esp32（更新中）</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-07-23T16:00:00.000Z" title="发表于 2023-07-24 00:00:00">2023-07-24</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-07-28T16:00:00.000Z" title="更新于 2023-07-29 00:00:00">2023-07-29</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%8D%95%E7%89%87%E6%9C%BA/">单片机</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">7.1k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>36分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="micropython+esp32（更新中）"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>网络卡顿无法加载图片请访问备用网址</p>
<p><a
target="_blank" rel="noopener" href="https://flowus.cn/5ebf448f-361b-40d0-937e-af26b0bffbb7">Micropython+esp32
(flowus.cn)</a></p>
<h2 id="描述">描述</h2>
<p>之前做物联网项目使用了 micropython+esp32
,现在手里刚到了新的板子和一批外设，想过一遍例程
，再转入espidf深入学习。</p>
<h2 id="教程">教程</h2>
<p><a
target="_blank" rel="noopener" href="https://doc.itprojects.cn/0006.zhishi.esp32/02.doc/index.html#/">it项目网www.itprojects.cn</a></p>
<p><a
target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1G34y1E7tE/?spm_id_from=333.1007.top_right_bar_window_custom_collection.content.click&amp;vd_source=02db1c625d35cb658b463558f61202bc">Python+ESP32
快速上手（持续更新中） wifi 蓝牙 智能控制
单片机_哔哩哔哩_bilibili</a></p>
<h2 id="esp-32-电路图">esp 32 电路图</h2>
<p><a
target="_blank" rel="noopener" href="https://doc.itprojects.cn/0006.zhishi.esp32/01.download/esp32_Schematic%20Prints.pdf">Schematic
Prints (itprojects.cn)</a></p>
<h2 id="esp332-技术规格书">esp332 技术规格书</h2>
<p><a
target="_blank" rel="noopener" href="https://doc.itprojects.cn/0006.zhishi.esp32/01.download/esp_wroom_32_datasheet_cn.pdf">esp_wroom_32_datasheet_cn.pdf
(itprojects.cn)</a></p>
<h2 id="开发环境搭建">开发环境搭建</h2>
<h3 id="thonny-下载">1. Thonny 下载</h3>
<p>https://thonny.org/</p>
<h3 id="micropython-下载">2. micropython 下载</h3>
<p><a
target="_blank" rel="noopener" href="https://doc.itprojects.cn/0006.zhishi.esp32/02.doc/index.html#/01.dajianhuanjing?id=_3-下载micropython">下载MicroPython</a></p>
<h3 id="驱动下载">3. 驱动下载</h3>
<p>https://doc.itprojects.cn/0006.zhishi.esp32/01.download/esp32usbDriver.zip</p>
<h3 id="烧录micropython到eps32">4. 烧录MicroPython到EPS32</h3>
<p>运行-配置解释器-选择串口，点击 intall or update micropython
，找到固件 esp32-2022xxx.bin ，安装。</p>
<figure>
<img
src="https://raw.githubusercontent.com/Center-cr/picture/main/202307240032188.png"
alt="image-20230723235919734" />
<figcaption aria-hidden="true">image-20230723235919734</figcaption>
</figure>
<p>不要直接关闭配置解释器界面，回到配置解释界面，不然相当于没选串口了，点击“好的”
，成功运行</p>
<p><img
src="https://raw.githubusercontent.com/Center-cr/picture/main/202307240032811.png"
alt="image-20230724000413979" />命令行界面如下显示连接成功</p>
<figure>
<img
src="https://raw.githubusercontent.com/Center-cr/picture/main/202307240032815.png"
alt="image-20230724000457492" />
<figcaption aria-hidden="true">image-20230724000457492</figcaption>
</figure>
<h2 id="点亮-led-灯">点亮 LED 灯</h2>
<p>查看电路图观察灯与 LED 的连接管脚</p>
<figure>
<img
src="https://raw.githubusercontent.com/Center-cr/picture/main/202307240033361.png"
alt="image-20230724001005944" />
<figcaption aria-hidden="true">image-20230724001005944</figcaption>
</figure>
<p>转到 Micropython 官方文档,查找怎么设置电平</p>
<p><a
target="_blank" rel="noopener" href="http://docs.micropython.org/en/latest/esp32/quickref.html">Quick
reference for the ESP32 — MicroPython latest documentation</a></p>
<p>文档位置<a
target="_blank" rel="noopener" href="http://docs.micropython.org/en/latest/esp32/quickref.html#pins-and-gpio">Quick
reference for the ESP32 — MicroPython latest documentation</a></p>
<p><img src="https://raw.githubusercontent.com/Center-cr/picture/main/202307240033085.png" alt="image-20230724001607339" style="zoom:50%;" /></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> machine <span class="keyword">import</span> Pin</span><br><span class="line"></span><br><span class="line">pin2 = Pin(<span class="number">2</span>, Pin.OUT)</span><br><span class="line">pin2.value(<span class="number">1</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>成功点亮蓝灯 ，效果如下：</p>
<p><img src="https://raw.githubusercontent.com/Center-cr/picture/main/202307240034570.png" alt="image-20230724001416328" style="zoom:33%;" /></p>
<h2 id="pwm-呼吸灯">PWM 呼吸灯</h2>
<p>PWM（Pulse Width Modulation）简称脉宽调制</p>
<p>占空比越高灯越亮，循环改变占空比实现“呼吸”。</p>
<p>MicroPython官方文档：http://docs.micropython.org/en/latest/esp32/quickref.html</p>
<p>使用了machine 的 PWM 类</p>
<h3 id="官方例程">官方例程</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> machine <span class="keyword">import</span> Pin, PWM</span><br><span class="line"></span><br><span class="line">pwm0 = PWM(Pin(<span class="number">0</span>))         <span class="comment"># create PWM object from a pin</span></span><br><span class="line">freq = pwm0.freq()         <span class="comment"># get current frequency (default 5kHz)</span></span><br><span class="line">pwm0.freq(<span class="number">1000</span>)            <span class="comment"># set PWM frequency from 1Hz to 40MHz</span></span><br><span class="line"></span><br><span class="line">duty = pwm0.duty()         <span class="comment"># get current duty cycle, range 0-1023 (default 512, 50%)</span></span><br><span class="line">pwm0.duty(<span class="number">256</span>)             <span class="comment"># set duty cycle from 0 to 1023 as a ratio duty/1023, (now 25%)</span></span><br></pre></td></tr></table></figure>
<h3 id="实例">实例</h3>
<h4 id="亮度">亮度</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> machine <span class="keyword">import</span> Pin, PWM</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">led2 = PWM(Pin(<span class="number">2</span>))</span><br><span class="line">led2.freq(<span class="number">1000</span>)</span><br><span class="line">led2.duty(<span class="number">100</span>)</span><br></pre></td></tr></table></figure>
<h4 id="呼吸灯">呼吸灯</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> machine <span class="keyword">import</span> Pin, PWM</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">led2 = PWM(Pin(<span class="number">2</span>))</span><br><span class="line">led2.freq(<span class="number">1000</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">1024</span>):</span><br><span class="line">        led2.duty(i)</span><br><span class="line">        time.sleep_ms(<span class="number">1</span>)</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1023</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">        led2.duty(i)</span><br><span class="line">        time.sleep_ms(<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<p>呼吸灯效果如下：</p>
<figure>
<img
src="https://raw.githubusercontent.com/Center-cr/picture/main/202307240035232.gif"
alt="QQ图片20230724002828" />
<figcaption aria-hidden="true">QQ图片20230724002828</figcaption>
</figure>
<h2 id="链接-wifi">链接 Wifi</h2>
<p><code>Wi-Fi</code>网络环境通常有两种设备</p>
<ul>
<li>Access Point(<code>AP</code>)
无线接入点，提供无线接入的设备，家里的光猫就是结合WiFi和internet路由功能的AP。AP和AP可以相互连接。</li>
<li>Station(<code>STA</code>)
无线终端，连接到AP的装置，手机，电脑等需要联网的设备都是出于STA模式，这个模式不允许其他设备接入</li>
</ul>
<h3 id="官方示例">官方示例</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> network</span><br><span class="line"></span><br><span class="line">wlan = network.WLAN(network.STA_IF) <span class="comment"># create station interface</span></span><br><span class="line">wlan.active(<span class="literal">True</span>)       <span class="comment"># activate the interface</span></span><br><span class="line">wlan.scan()             <span class="comment"># scan for access points</span></span><br><span class="line">wlan.isconnected()      <span class="comment"># check if the station is connected to an AP</span></span><br><span class="line">wlan.connect(<span class="string">&#x27;essid&#x27;</span>, <span class="string">&#x27;password&#x27;</span>) <span class="comment"># connect to an AP</span></span><br><span class="line">wlan.config(<span class="string">&#x27;mac&#x27;</span>)      <span class="comment"># get the interface&#x27;s MAC address</span></span><br><span class="line">wlan.ifconfig()         <span class="comment"># get the interface&#x27;s IP/netmask/gw/DNS addresses</span></span><br></pre></td></tr></table></figure>
<h3 id="实例-1">实例</h3>
<p>封装成函数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> network</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">ssid = <span class="string">&quot;Mr.CARD&quot;</span> <span class="comment"># wifi 名称</span></span><br><span class="line">password = <span class="string">&quot;88888888&quot;</span> <span class="comment"># wifi 密码</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">do_connect</span>():</span><br><span class="line">    wlan = network.WLAN(network.STA_IF)</span><br><span class="line">    wlan.active(<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> wlan.isconnected():</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;connecting to network...&#x27;</span>)</span><br><span class="line">        wlan.connect(ssid, password)</span><br><span class="line">        i = <span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">not</span> wlan.isconnected():</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;正在链接...&#123;&#125;&quot;</span>.<span class="built_in">format</span>(i))</span><br><span class="line">            i += <span class="number">1</span></span><br><span class="line">            time.sleep(<span class="number">1</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;network config:&#x27;</span>, wlan.ifconfig())</span><br><span class="line">do_connect()</span><br></pre></td></tr></table></figure>
<h3 id="局域网udp链接">局域网UDP链接</h3>
<p>在连接 wifi 后测试局域网 UDP 通信</p>
<h3 id="esp32-发送-hello-world-给pc">ESP32 发送 “hello world ” 给PC</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 创建udp套接字</span></span><br><span class="line">udp_socket = socket(AF_INET, SOCK_DGRAM)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 准备接收方的地址</span></span><br><span class="line">dest_addr = (<span class="string">&#x27;192.168.31.56&#x27;</span>, <span class="number">8080</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 从键盘获取数据</span></span><br><span class="line">send_data = <span class="string">&quot;hello world&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 发送数据到指定的电脑上</span></span><br><span class="line">udp_socket.sendto(send_data.encode(<span class="string">&#x27;utf-8&#x27;</span>), dest_addr)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. 关闭套接字</span></span><br><span class="line">udp_socket.close()</span><br></pre></td></tr></table></figure>
<h4 id="最终效果">最终效果</h4>
<figure>
<img
src="https://raw.githubusercontent.com/Center-cr/picture/main/202307250124578.png"
title="image-20230725010217693" alt="image-20230725010217693" />
<figcaption aria-hidden="true">image-20230725010217693</figcaption>
</figure>
<p>如果出现UDP
打不开的情况，找到设备管理器-网络适配器，查看是否开启虚拟机网卡或 LAN
,禁用</p>
<figure>
<img
src="https://raw.githubusercontent.com/Center-cr/picture/main/202307250124143.png"
alt="image-20230725012146517" />
<figcaption aria-hidden="true">image-20230725012146517</figcaption>
</figure>
<h3 id="pc-发送-nice-to-meey-you-给-esp32">PC 发送 “nice to meey you ”
给 ESP32</h3>
<p>建立UDP广播后可以与PC 进行 UDP 通信，注意先把上述代码第 5 步注释掉
，再重新运行。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">recv_data = udp_socket.recvfrom(<span class="number">1024</span>)</span><br></pre></td></tr></table></figure>
<p>注意远程主机填写，点击清除后复制 ESP32 的 IP 和端口</p>
<figure>
<img
src="https://raw.githubusercontent.com/Center-cr/picture/main/202307250124139.png"
alt="image-20230725011852003" />
<figcaption aria-hidden="true">image-20230725011852003</figcaption>
</figure>
<h4 id="最终效果-1">最终效果</h4>
<figure>
<img
src="https://raw.githubusercontent.com/Center-cr/picture/main/202307250124749.png"
alt="image-20230725011719057" />
<figcaption aria-hidden="true">image-20230725011719057</figcaption>
</figure>
<h2 id="pc-控制-led-灯">PC 控制 LED 灯</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 整体流程</span></span><br><span class="line"><span class="comment"># 1. 链接wifi</span></span><br><span class="line"><span class="comment"># 2. 启动网络功能（UDP）</span></span><br><span class="line"><span class="comment"># 3. 接收网络数据</span></span><br><span class="line"><span class="comment"># 4. 处理接收的数据</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> network</span><br><span class="line"><span class="keyword">import</span> machine</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">do_connect</span>():</span><br><span class="line">    wlan = network.WLAN(network.STA_IF)</span><br><span class="line">    wlan.active(<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> wlan.isconnected():</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;connecting to network...&#x27;</span>)</span><br><span class="line">        wlan.connect(<span class="string">&#x27;Mr.CARD&#x27;</span>, <span class="string">&#x27;88888888&#x27;</span>)</span><br><span class="line">        i = <span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">not</span> wlan.isconnected():</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;正在链接...&#123;&#125;&quot;</span>.<span class="built_in">format</span>(i))</span><br><span class="line">            i += <span class="number">1</span></span><br><span class="line">            time.sleep(<span class="number">1</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;network config:&#x27;</span>, wlan.ifconfig())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">start_udp</span>():</span><br><span class="line">    <span class="comment"># 2. 启动网络功能（UDP）</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2.1. 创建udp套接字</span></span><br><span class="line">    udp_socket = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 2.2. 绑定本地信息</span></span><br><span class="line">    udp_socket.bind((<span class="string">&quot;0.0.0.0&quot;</span>, <span class="number">7788</span>))</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 2.3 准备接收方的地址</span></span><br><span class="line">    dest_addr = (<span class="string">&#x27;192.168.126.156&#x27;</span>, <span class="number">8080</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 2.4 从键盘获取数据</span></span><br><span class="line">    send_data = <span class="string">&quot;hello world&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2.5 发送数据到指定的电脑上</span></span><br><span class="line">    udp_socket.sendto(send_data.encode(<span class="string">&#x27;utf-8&#x27;</span>), dest_addr)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> udp_socket</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="comment"># 1. 链接wifi</span></span><br><span class="line">    do_connect()</span><br><span class="line">    <span class="comment"># 2. 创建UDP</span></span><br><span class="line">    udp_socket = start_udp()</span><br><span class="line">    <span class="comment"># 3. 创建灯对象</span></span><br><span class="line">    led = machine.Pin(<span class="number">2</span>, machine.Pin.OUT)</span><br><span class="line">    <span class="comment"># 4. 接收网络数据</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line"></span><br><span class="line">        recv_data, sender_info = udp_socket.recvfrom(<span class="number">1024</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;&#123;&#125;发送&#123;&#125;&quot;</span>.<span class="built_in">format</span>(sender_info, recv_data))</span><br><span class="line">        recv_data_str = recv_data.decode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="built_in">print</span>(recv_data_str)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> ret:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;error:&quot;</span>, ret)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 5. 处理接收的数据</span></span><br><span class="line">        <span class="keyword">if</span> recv_data_str == <span class="string">&quot;light on&quot;</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;这里是要灯亮的代码...&quot;</span>)</span><br><span class="line">            led.value(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">elif</span> recv_data_str == <span class="string">&quot;light off&quot;</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;这里是要灯灭的代码...&quot;</span>)</span><br><span class="line">            led.value(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>第 35 行 #2.2 <code>udp_socket.bind(("0.0.0.0", 7788))</code> 在
esp32 上绑定端口，不然每次 UDP
广播时使用的端口都不一样，造成网络调试器每次要发送信息给 esp32
时都要修改端口</p>
<h3 id="实例-2">实例</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 整体流程</span></span><br><span class="line"><span class="comment"># 1. 链接wifi</span></span><br><span class="line"><span class="comment"># 2. 启动网络功能（UDP）</span></span><br><span class="line"><span class="comment"># 3. 接收网络数据</span></span><br><span class="line"><span class="comment"># 4. 处理接收的数据</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> network</span><br><span class="line"><span class="keyword">import</span> machine</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">do_connect</span>():</span><br><span class="line">    wlan = network.WLAN(network.STA_IF)</span><br><span class="line">    wlan.active(<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> wlan.isconnected():</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;connecting to network...&#x27;</span>)</span><br><span class="line">        wlan.connect(<span class="string">&#x27;Mr.CARD&#x27;</span>, <span class="string">&#x27;88888888&#x27;</span>)</span><br><span class="line">        i = <span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">not</span> wlan.isconnected():</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;正在链接...&#123;&#125;&quot;</span>.<span class="built_in">format</span>(i))</span><br><span class="line">            i += <span class="number">1</span></span><br><span class="line">            time.sleep(<span class="number">1</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;network config:&#x27;</span>, wlan.ifconfig())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">start_udp</span>():</span><br><span class="line">    <span class="comment"># 2. 启动网络功能（UDP）</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2.1. 创建udp套接字</span></span><br><span class="line">    </span><br><span class="line">    udp_socket = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)</span><br><span class="line">    <span class="comment"># 2.2. 绑定本地信息</span></span><br><span class="line">    udp_socket.bind((<span class="string">&quot;0.0.0.0&quot;</span>, <span class="number">7788</span>))</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 2.3 准备接收方的地址</span></span><br><span class="line">    dest_addr = (<span class="string">&#x27;192.168.126.156&#x27;</span>, <span class="number">8080</span>)</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2.4 从键盘获取数据</span></span><br><span class="line">    send_data = <span class="string">&quot;hello world&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2.5 发送数据到指定的电脑上</span></span><br><span class="line">    udp_socket.sendto(send_data.encode(<span class="string">&#x27;utf-8&#x27;</span>), dest_addr)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> udp_socket</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="comment"># 1. 链接wifi</span></span><br><span class="line">    do_connect()</span><br><span class="line">    <span class="comment"># 2. 创建UDP</span></span><br><span class="line">    udp_socket = start_udp()</span><br><span class="line">    <span class="comment"># 3. 创建灯对象</span></span><br><span class="line">    led = machine.Pin(<span class="number">2</span>, machine.Pin.OUT)</span><br><span class="line">    <span class="comment"># 4. 接收网络数据</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line"></span><br><span class="line">        recv_data, sender_info = udp_socket.recvfrom(<span class="number">1024</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;&#123;&#125;发送&#123;&#125;&quot;</span>.<span class="built_in">format</span>(sender_info, recv_data))</span><br><span class="line">        recv_data_str = recv_data.decode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="built_in">print</span>(recv_data_str)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> ret:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;error:&quot;</span>, ret)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 5. 处理接收的数据</span></span><br><span class="line">        <span class="keyword">if</span> recv_data_str == <span class="string">&quot;light on&quot;</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;这里是要灯亮的代码...&quot;</span>)</span><br><span class="line">            led.value(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">elif</span> recv_data_str == <span class="string">&quot;light off&quot;</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;这里是要灯灭的代码...&quot;</span>)</span><br><span class="line">            led.value(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="最终效果-2">最终效果</h3>
<figure>
<img
src="https://raw.githubusercontent.com/Center-cr/picture/main/202307260258859.png"
alt="image-20230726013403379" />
<figcaption aria-hidden="true">image-20230726013403379</figcaption>
</figure>
<figure>
<img
src="https://raw.githubusercontent.com/Center-cr/picture/main/202307260258831.png"
alt="image-20230726013433213" />
<figcaption aria-hidden="true">image-20230726013433213</figcaption>
</figure>
<h2 id="数码管显示">数码管显示</h2>
<h3 id="面包板使用">面包板使用</h3>
<p><img
src="https://raw.githubusercontent.com/Center-cr/picture/main/202307260303737.png" /></p>
<figure>
<img
src="https://raw.githubusercontent.com/Center-cr/picture/main/202307260259970.png"
alt="image-20230726014805551" />
<figcaption aria-hidden="true">image-20230726014805551</figcaption>
</figure>
<h3 id="共阴数码管">共阴数码管</h3>
<figure>
<img
src="https://raw.githubusercontent.com/Center-cr/picture/main/202307260258936.png"
alt="image-20230726014835104" />
<figcaption aria-hidden="true">image-20230726014835104</figcaption>
</figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> machine</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">a = machine.Pin(<span class="number">13</span>, machine.Pin.OUT)</span><br><span class="line">b = machine.Pin(<span class="number">12</span>, machine.Pin.OUT)</span><br><span class="line">c = machine.Pin(<span class="number">14</span>, machine.Pin.OUT)</span><br><span class="line">d = machine.Pin(<span class="number">27</span>, machine.Pin.OUT)</span><br><span class="line">e = machine.Pin(<span class="number">26</span>, machine.Pin.OUT)</span><br><span class="line">f = machine.Pin(<span class="number">25</span>, machine.Pin.OUT)</span><br><span class="line">g = machine.Pin(<span class="number">33</span>, machine.Pin.OUT)</span><br><span class="line">dot = machine.Pin(<span class="number">32</span>, machine.Pin.OUT)</span><br><span class="line"></span><br><span class="line">number_led = [a, b, c, d, e, f, g, dot]</span><br><span class="line"></span><br><span class="line">number_dict = &#123;</span><br><span class="line">    <span class="number">0</span>: <span class="string">&quot;11111100&quot;</span>,</span><br><span class="line">    <span class="number">1</span>: <span class="string">&quot;01100000&quot;</span>,</span><br><span class="line">    <span class="number">2</span>: <span class="string">&quot;11011010&quot;</span>,</span><br><span class="line">    <span class="number">3</span>: <span class="string">&quot;11110010&quot;</span>,</span><br><span class="line">    <span class="number">4</span>: <span class="string">&quot;01100110&quot;</span>,</span><br><span class="line">    <span class="number">5</span>: <span class="string">&quot;10110110&quot;</span>,</span><br><span class="line">    <span class="number">6</span>: <span class="string">&quot;10111110&quot;</span>,</span><br><span class="line">    <span class="number">7</span>: <span class="string">&quot;11100000&quot;</span>,</span><br><span class="line">    <span class="number">8</span>: <span class="string">&quot;11111110&quot;</span>,</span><br><span class="line">    <span class="number">9</span>: <span class="string">&quot;11110110&quot;</span>,</span><br><span class="line">    <span class="string">&quot;open&quot;</span>: <span class="string">&quot;11111111&quot;</span>,</span><br><span class="line">    <span class="string">&quot;close&quot;</span>: <span class="string">&quot;00000000&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show_number</span>(<span class="params">number</span>):</span><br><span class="line">    <span class="keyword">if</span> number_dict.get(number):</span><br><span class="line">        i = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> bit <span class="keyword">in</span> number_dict.get(number):</span><br><span class="line">            <span class="keyword">if</span> bit == <span class="string">&quot;1&quot;</span>:</span><br><span class="line">                number_led[i].value(<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                number_led[i].value(<span class="number">0</span>)</span><br><span class="line">            i += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="comment"># show_number(&quot;open&quot;)  # 全亮</span></span><br><span class="line">    <span class="comment"># show_number(&quot;close&quot;)  # 全灭</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">            show_number(i)</span><br><span class="line">            time.sleep(<span class="number">0.6</span>)</span><br><span class="line">            <span class="built_in">print</span>(i)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>32 行</p>
<p><code>if number_dict.get(number):</code>
判断列表里是否有该索引的值</p>
<p>34 ~39 行</p>
<p><code>for bit in number_dict.get(number):</code></p>
<p>bit 是具体位的值（0/1），i 是 第 i 位（0~7）</p>
<h3 id="问题">问题</h3>
<p>1、 数码管不亮：限流电阻过大</p>
<p>2、有的数字显示缺笔画： 电阻没插好或电阻引脚碰撞</p>
<h3 id="最终效果-3">最终效果</h3>
<figure>
<img
src="https://raw.githubusercontent.com/Center-cr/picture/main/202307260300200.gif"
alt="QQ图片20230726024609" />
<figcaption aria-hidden="true">QQ图片20230726024609</figcaption>
</figure>
<h2 id="四位数数码管显示">四位数数码管显示</h2>
<p>四个七段数码管共用 a~h ,因此只能同时有一位有效</p>
<p>这个代码通过循环位选操作，循环点亮四个位</p>
<p>第一次运行例程发现显示乱码，发现原作者所用的是共阳极数码管，而自己手里的四位数码管是共阴极，低电平有效.因此需要将
value(0) 、value(1) 交换</p>
<h3 id="实例-3">实例</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> machine</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">led1 = machine.Pin(<span class="number">5</span>, machine.Pin.OUT)</span><br><span class="line">led2 = machine.Pin(<span class="number">18</span>, machine.Pin.OUT)</span><br><span class="line">led3 = machine.Pin(<span class="number">19</span>, machine.Pin.OUT)</span><br><span class="line">led4 = machine.Pin(<span class="number">21</span>, machine.Pin.OUT)</span><br><span class="line"></span><br><span class="line">number_led_list = [led1, led2, led3, led4]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">a = machine.Pin(<span class="number">13</span>, machine.Pin.OUT)</span><br><span class="line">b = machine.Pin(<span class="number">12</span>, machine.Pin.OUT)</span><br><span class="line">c = machine.Pin(<span class="number">14</span>, machine.Pin.OUT)</span><br><span class="line">d = machine.Pin(<span class="number">27</span>, machine.Pin.OUT)</span><br><span class="line">e = machine.Pin(<span class="number">26</span>, machine.Pin.OUT)</span><br><span class="line">f = machine.Pin(<span class="number">25</span>, machine.Pin.OUT)</span><br><span class="line">g = machine.Pin(<span class="number">33</span>, machine.Pin.OUT)</span><br><span class="line">h = machine.Pin(<span class="number">32</span>, machine.Pin.OUT)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将对应的引脚对象存储到列表</span></span><br><span class="line">led_list = [a, b, c, d, e, f, g, h]</span><br><span class="line"></span><br><span class="line">number_dict = &#123;</span><br><span class="line">    <span class="number">0</span>: <span class="string">&quot;11111100&quot;</span>,</span><br><span class="line">    <span class="number">1</span>: <span class="string">&quot;01100000&quot;</span>,</span><br><span class="line">    <span class="number">2</span>: <span class="string">&quot;11011010&quot;</span>,</span><br><span class="line">    <span class="number">3</span>: <span class="string">&quot;11110010&quot;</span>,</span><br><span class="line">    <span class="number">4</span>: <span class="string">&quot;01100110&quot;</span>,</span><br><span class="line">    <span class="number">5</span>: <span class="string">&quot;10110110&quot;</span>,</span><br><span class="line">    <span class="number">6</span>: <span class="string">&quot;10111110&quot;</span>,</span><br><span class="line">    <span class="number">7</span>: <span class="string">&quot;11100000&quot;</span>,</span><br><span class="line">    <span class="number">8</span>: <span class="string">&quot;11111110&quot;</span>,</span><br><span class="line">    <span class="number">9</span>: <span class="string">&quot;11110110&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show_number</span>(<span class="params">number</span>):</span><br><span class="line">    <span class="keyword">if</span> number_dict.get(number):</span><br><span class="line">        i = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> num <span class="keyword">in</span> number_dict.get(number):  <span class="comment"># 此时就是对应的value，即类似的&quot;01110111&quot;</span></span><br><span class="line">            <span class="keyword">if</span> num == <span class="string">&quot;1&quot;</span>:</span><br><span class="line">                led_list[i].value(<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                led_list[i].value(<span class="number">0</span>)</span><br><span class="line">            i += <span class="number">1</span></span><br><span class="line">            </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">led_light_on</span>(<span class="params">i</span>):</span><br><span class="line">    <span class="comment"># 全部设置为0</span></span><br><span class="line">    <span class="keyword">for</span> led <span class="keyword">in</span> number_led_list:</span><br><span class="line">        led.value(<span class="number">1</span>)</span><br><span class="line">        </span><br><span class="line">    number_led_list[i].value(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show_4_number</span>(<span class="params">number</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="number">0</span> &lt;= number &lt;= <span class="number">9999</span>:</span><br><span class="line">        i = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> num <span class="keyword">in</span> <span class="string">&quot;%04d&quot;</span> % number:</span><br><span class="line">            led_light_on(i)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;i=&quot;</span>,i)</span><br><span class="line">            <span class="built_in">print</span>(num)</span><br><span class="line">            show_number(<span class="built_in">int</span>(num))</span><br><span class="line">            time.sleep_ms(<span class="number">10</span>)</span><br><span class="line">            i += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1234</span>, <span class="number">10000</span>):d</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">            show_4_number(i)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>66 行的延时是用来确定频闪</p>
<p>72 循环是用来校正时间间隔为1s左右</p>
<p>计数间隔是由这两个循环的延时积得到</p>
<h3 id="最终效果-4">最终效果</h3>
<p><img src="relative/QQ图片20230728204255.gif" alt="QQ图片20230728204255" style="zoom:33%;" /></p>
<h2 id="lcd与i2c">1602LCD与I2C</h2>
<figure>
<img
src="https://raw.githubusercontent.com/Center-cr/picture/main/202307290026342.png"
alt="image-20230728214247443" />
<figcaption aria-hidden="true">image-20230728214247443</figcaption>
</figure>
<h3 id="lcd">1602LCD</h3>
<p>1602LCD是指显示的内容为16X2,即可以显示两行，每行16个字符液晶模块(显示字符和数字)</p>
<p>市面上字符液晶大多数是基于HD44780液晶芯片的</p>
<h3 id="i2c">I2C</h3>
<p>I2C（Inter-Integrated
Circuit），中文叫集成电路总线，它是一种串行通信总线，使用多主从架构，是由飞利浦公司在1980年代初设计的，方便了主板、嵌入式系统或手机与周边设备组件之间的通讯。由于其简单性，它被广泛用于微控制器与传感器阵列，显示器，IoT设备，EEPROM等之间的通信。</p>
<p>最重要的功能包括：</p>
<p>只需要两条总线
所有组件之间都存在简单的主/从关系，连接到总线的每个设备均可通过唯一地址进行软件寻址
I2C是真正的多主设备总线，可提供仲裁和冲突检测 传输速度
标准模式：Standard Mode = 100 Kbps 快速模式：Fast Mode = 400 Kbps
高速模式： High speed mode = 3.4 Mbps 超快速模式： Ultra fast mode = 5
Mbps 最大主设备数：无限制 最大从机数：理论上是127</p>
<p>大白话：一种只用2根线就可以传递很多数据给其它多台设备的方法，这种方法叫I2C</p>
<p>大大减少了MCU上IO的使用</p>
<h3 id="pcf8574">PCF8574</h3>
<p><a
target="_blank" rel="noopener" href="https://blog.csdn.net/qq_17525633/article/details/117556152">芯片简介之PCF8574</a></p>
<p>PCF8574 是
NXP公司生产的一款芯片。该芯片可以通过IIC协议进行IO口扩展。每个IO口可以单独的分配为输入或者输出。例如，作为输入时，可以用于监控中断或者键盘。作为输出时，可以用于点亮发光二极管。系统控制器可以通过单独的寄存器读取输入端口状态或者配置输出端口状态。</p>
<p>因为该芯片具有三个地址管脚，也就是最多可以同时分配8个地址。所以，在同一个系统中，最多可以通过16个管脚拓展出128个IO口。此外，该芯片还提供一个中断管脚(低电平有效)。当任何一个输入管脚和其对应的寄存器状态不同时，触发该中断。</p>
<p>为了节省电能，PCF8574内部没有在地址管脚放置上拉电阻，因此，这几个地址必须外部置高或者置低。这些地址管脚可以直连或者通过一个电阻连接到VCC或者GND。</p>
<h3 id="micropython官方文档iic">Micropython官方文档（IIC）</h3>
<p><a
target="_blank" rel="noopener" href="http://docs.micropython.org/en/latest/esp32/quickref.html#software-i2c-bus">Quick
reference for the ESP32 — MicroPython latest documentation</a></p>
<h3 id="需要的api驱动模块">需要的api、驱动模块</h3>
<ul>
<li><code>lcd_api.py</code>：https://doc.itprojects.cn/0006.zhishi.esp32/01.download/lcd_api.py</li>
<li><code>esp32_i2c_1602lcd.py</code>：https://doc.itprojects.cn/0006.zhishi.esp32/01.download/esp32_i2c_1602lcd.py</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;Provides an API for talking to HD44780 compatible character LCDs.&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LcdApi</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Implements the API for talking with HD44780 compatible character LCDs.</span></span><br><span class="line"><span class="string">    This class only knows what commands to send to the LCD, and not how to get</span></span><br><span class="line"><span class="string">    them to the LCD.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    It is expected that a derived class will implement the hal_xxx functions.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># The following constant names were lifted from the avrlib lcd.h</span></span><br><span class="line">    <span class="comment"># header file, however, I changed the definitions from bit numbers</span></span><br><span class="line">    <span class="comment"># to bit masks.</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># HD44780 LCD controller command set</span></span><br><span class="line"></span><br><span class="line">    LCD_CLR = <span class="number">0x01</span>              <span class="comment"># DB0: clear display</span></span><br><span class="line">    LCD_HOME = <span class="number">0x02</span>             <span class="comment"># DB1: return to home position</span></span><br><span class="line"></span><br><span class="line">    LCD_ENTRY_MODE = <span class="number">0x04</span>       <span class="comment"># DB2: set entry mode</span></span><br><span class="line">    LCD_ENTRY_INC = <span class="number">0x02</span>        <span class="comment"># --DB1: increment</span></span><br><span class="line">    LCD_ENTRY_SHIFT = <span class="number">0x01</span>      <span class="comment"># --DB0: shift</span></span><br><span class="line"></span><br><span class="line">    LCD_ON_CTRL = <span class="number">0x08</span>          <span class="comment"># DB3: turn lcd/cursor on</span></span><br><span class="line">    LCD_ON_DISPLAY = <span class="number">0x04</span>       <span class="comment"># --DB2: turn display on</span></span><br><span class="line">    LCD_ON_CURSOR = <span class="number">0x02</span>        <span class="comment"># --DB1: turn cursor on</span></span><br><span class="line">    LCD_ON_BLINK = <span class="number">0x01</span>         <span class="comment"># --DB0: blinking cursor</span></span><br><span class="line"></span><br><span class="line">    LCD_MOVE = <span class="number">0x10</span>             <span class="comment"># DB4: move cursor/display</span></span><br><span class="line">    LCD_MOVE_DISP = <span class="number">0x08</span>        <span class="comment"># --DB3: move display (0-&gt; move cursor)</span></span><br><span class="line">    LCD_MOVE_RIGHT = <span class="number">0x04</span>       <span class="comment"># --DB2: move right (0-&gt; left)</span></span><br><span class="line"></span><br><span class="line">    LCD_FUNCTION = <span class="number">0x20</span>         <span class="comment"># DB5: function set</span></span><br><span class="line">    LCD_FUNCTION_8BIT = <span class="number">0x10</span>    <span class="comment"># --DB4: set 8BIT mode (0-&gt;4BIT mode)</span></span><br><span class="line">    LCD_FUNCTION_2LINES = <span class="number">0x08</span>  <span class="comment"># --DB3: two lines (0-&gt;one line)</span></span><br><span class="line">    LCD_FUNCTION_10DOTS = <span class="number">0x04</span>  <span class="comment"># --DB2: 5x10 font (0-&gt;5x7 font)</span></span><br><span class="line">    LCD_FUNCTION_RESET = <span class="number">0x30</span>   <span class="comment"># See &quot;Initializing by Instruction&quot; section</span></span><br><span class="line"></span><br><span class="line">    LCD_CGRAM = <span class="number">0x40</span>            <span class="comment"># DB6: set CG RAM address</span></span><br><span class="line">    LCD_DDRAM = <span class="number">0x80</span>            <span class="comment"># DB7: set DD RAM address</span></span><br><span class="line"></span><br><span class="line">    LCD_RS_CMD = <span class="number">0</span></span><br><span class="line">    LCD_RS_DATA = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    LCD_RW_WRITE = <span class="number">0</span></span><br><span class="line">    LCD_RW_READ = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, num_lines, num_columns</span>):</span><br><span class="line">        self.num_lines = num_lines</span><br><span class="line">        <span class="keyword">if</span> self.num_lines &gt; <span class="number">4</span>:</span><br><span class="line">            self.num_lines = <span class="number">4</span></span><br><span class="line">        self.num_columns = num_columns</span><br><span class="line">        <span class="keyword">if</span> self.num_columns &gt; <span class="number">40</span>:</span><br><span class="line">            self.num_columns = <span class="number">40</span></span><br><span class="line">        self.cursor_x = <span class="number">0</span></span><br><span class="line">        self.cursor_y = <span class="number">0</span></span><br><span class="line">        self.backlight = <span class="literal">True</span></span><br><span class="line">        self.display_off()</span><br><span class="line">        self.backlight_on()</span><br><span class="line">        self.clear()</span><br><span class="line">        self.hal_write_command(self.LCD_ENTRY_MODE | self.LCD_ENTRY_INC)</span><br><span class="line">        self.hide_cursor()</span><br><span class="line">        self.display_on()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">clear</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Clears the LCD display and moves the cursor to the top left</span></span><br><span class="line"><span class="string">        corner.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        self.hal_write_command(self.LCD_CLR)</span><br><span class="line">        self.hal_write_command(self.LCD_HOME)</span><br><span class="line">        self.cursor_x = <span class="number">0</span></span><br><span class="line">        self.cursor_y = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">show_cursor</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Causes the cursor to be made visible.&quot;&quot;&quot;</span></span><br><span class="line">        self.hal_write_command(self.LCD_ON_CTRL | self.LCD_ON_DISPLAY |</span><br><span class="line">                               self.LCD_ON_CURSOR)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">hide_cursor</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Causes the cursor to be hidden.&quot;&quot;&quot;</span></span><br><span class="line">        self.hal_write_command(self.LCD_ON_CTRL | self.LCD_ON_DISPLAY)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">blink_cursor_on</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Turns on the cursor, and makes it blink.&quot;&quot;&quot;</span></span><br><span class="line">        self.hal_write_command(self.LCD_ON_CTRL | self.LCD_ON_DISPLAY |</span><br><span class="line">                               self.LCD_ON_CURSOR | self.LCD_ON_BLINK)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">blink_cursor_off</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Turns on the cursor, and makes it no blink (i.e. be solid).&quot;&quot;&quot;</span></span><br><span class="line">        self.hal_write_command(self.LCD_ON_CTRL | self.LCD_ON_DISPLAY |</span><br><span class="line">                               self.LCD_ON_CURSOR)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">display_on</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Turns on (i.e. unblanks) the LCD.&quot;&quot;&quot;</span></span><br><span class="line">        self.hal_write_command(self.LCD_ON_CTRL | self.LCD_ON_DISPLAY)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">display_off</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Turns off (i.e. blanks) the LCD.&quot;&quot;&quot;</span></span><br><span class="line">        self.hal_write_command(self.LCD_ON_CTRL)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">backlight_on</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Turns the backlight on.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        This isn&#x27;t really an LCD command, but some modules have backlight</span></span><br><span class="line"><span class="string">        controls, so this allows the hal to pass through the command.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        self.backlight = <span class="literal">True</span></span><br><span class="line">        self.hal_backlight_on()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">backlight_off</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Turns the backlight off.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        This isn&#x27;t really an LCD command, but some modules have backlight</span></span><br><span class="line"><span class="string">        controls, so this allows the hal to pass through the command.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        self.backlight = <span class="literal">False</span></span><br><span class="line">        self.hal_backlight_off()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">move_to</span>(<span class="params">self, cursor_x, cursor_y</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Moves the cursor position to the indicated position. The cursor</span></span><br><span class="line"><span class="string">        position is zero based (i.e. cursor_x == 0 indicates first column).</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        self.cursor_x = cursor_x</span><br><span class="line">        self.cursor_y = cursor_y</span><br><span class="line">        addr = cursor_x &amp; <span class="number">0x3f</span></span><br><span class="line">        <span class="keyword">if</span> cursor_y &amp; <span class="number">1</span>:</span><br><span class="line">            addr += <span class="number">0x40</span>    <span class="comment"># Lines 1 &amp; 3 add 0x40</span></span><br><span class="line">        <span class="keyword">if</span> cursor_y &amp; <span class="number">2</span>:</span><br><span class="line">            addr += <span class="number">0x14</span>    <span class="comment"># Lines 2 &amp; 3 add 0x14</span></span><br><span class="line">        self.hal_write_command(self.LCD_DDRAM | addr)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">putchar</span>(<span class="params">self, char</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Writes the indicated character to the LCD at the current cursor</span></span><br><span class="line"><span class="string">        position, and advances the cursor by one position.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> char != <span class="string">&#x27;\n&#x27;</span>:</span><br><span class="line">            self.hal_write_data(<span class="built_in">ord</span>(char))</span><br><span class="line">            self.cursor_x += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> self.cursor_x &gt;= self.num_columns <span class="keyword">or</span> char == <span class="string">&#x27;\n&#x27;</span>:</span><br><span class="line">            self.cursor_x = <span class="number">0</span></span><br><span class="line">            self.cursor_y += <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> self.cursor_y &gt;= self.num_lines:</span><br><span class="line">                self.cursor_y = <span class="number">0</span></span><br><span class="line">            self.move_to(self.cursor_x, self.cursor_y)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">putstr</span>(<span class="params">self, string</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Write the indicated string to the LCD at the current cursor</span></span><br><span class="line"><span class="string">        position and advances the cursor position appropriately.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">for</span> char <span class="keyword">in</span> string:</span><br><span class="line">            self.putchar(char)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">custom_char</span>(<span class="params">self, location, charmap</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Write a character to one of the 8 CGRAM locations, available</span></span><br><span class="line"><span class="string">        as chr(0) through chr(7).</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        location &amp;= <span class="number">0x7</span></span><br><span class="line">        self.hal_write_command(self.LCD_CGRAM | (location &lt;&lt; <span class="number">3</span>))</span><br><span class="line">        time.sleep_us(<span class="number">40</span>)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">            self.hal_write_data(charmap[i])</span><br><span class="line">            time.sleep_us(<span class="number">40</span>)</span><br><span class="line">        self.move_to(self.cursor_x, self.cursor_y)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">hal_backlight_on</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Allows the hal layer to turn the backlight on.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        If desired, a derived HAL class will implement this function.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">hal_backlight_off</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Allows the hal layer to turn the backlight off.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        If desired, a derived HAL class will implement this function.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">hal_write_command</span>(<span class="params">self, cmd</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Write a command to the LCD.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        It is expected that a derived HAL class will implement this</span></span><br><span class="line"><span class="string">        function.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">raise</span> NotImplementedError</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">hal_write_data</span>(<span class="params">self, data</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Write data to the LCD.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        It is expected that a derived HAL class will implement this</span></span><br><span class="line"><span class="string">        function.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">raise</span> NotImplementedError</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;Implements a HD44780 character LCD connected via PCF8574 on I2C.</span></span><br><span class="line"><span class="string">   This was tested with: https://www.wemos.cc/product/d1-mini.html&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> lcd_api <span class="keyword">import</span> LcdApi</span><br><span class="line"><span class="keyword">from</span> machine <span class="keyword">import</span> I2C</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep_ms</span><br><span class="line"></span><br><span class="line"><span class="comment"># Defines shifts or masks for the various LCD line attached to the PCF8574</span></span><br><span class="line"></span><br><span class="line">MASK_RS = <span class="number">0x01</span></span><br><span class="line">MASK_RW = <span class="number">0x02</span></span><br><span class="line">MASK_E = <span class="number">0x04</span></span><br><span class="line">SHIFT_BACKLIGHT = <span class="number">3</span></span><br><span class="line">SHIFT_DATA = <span class="number">4</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">I2cLcd</span>(<span class="title class_ inherited__">LcdApi</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Implements a HD44780 character LCD connected via PCF8574 on I2C.&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, i2c, i2c_addr, num_lines, num_columns</span>):</span><br><span class="line">        self.i2c = i2c</span><br><span class="line">        self.i2c_addr = i2c_addr</span><br><span class="line">        self.i2c.writeto(self.i2c_addr, <span class="built_in">bytearray</span>([<span class="number">0</span>]))</span><br><span class="line">        sleep_ms(<span class="number">20</span>)   <span class="comment"># Allow LCD time to powerup</span></span><br><span class="line">        <span class="comment"># Send reset 3 times</span></span><br><span class="line">        self.hal_write_init_nibble(self.LCD_FUNCTION_RESET)</span><br><span class="line">        sleep_ms(<span class="number">5</span>)    <span class="comment"># need to delay at least 4.1 msec</span></span><br><span class="line">        self.hal_write_init_nibble(self.LCD_FUNCTION_RESET)</span><br><span class="line">        sleep_ms(<span class="number">1</span>)</span><br><span class="line">        self.hal_write_init_nibble(self.LCD_FUNCTION_RESET)</span><br><span class="line">        sleep_ms(<span class="number">1</span>)</span><br><span class="line">        <span class="comment"># Put LCD into 4 bit mode</span></span><br><span class="line">        self.hal_write_init_nibble(self.LCD_FUNCTION)</span><br><span class="line">        sleep_ms(<span class="number">1</span>)</span><br><span class="line">        LcdApi.__init__(self, num_lines, num_columns)</span><br><span class="line">        cmd = self.LCD_FUNCTION</span><br><span class="line">        <span class="keyword">if</span> num_lines &gt; <span class="number">1</span>:</span><br><span class="line">            cmd |= self.LCD_FUNCTION_2LINES</span><br><span class="line">        self.hal_write_command(cmd)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">hal_write_init_nibble</span>(<span class="params">self, nibble</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Writes an initialization nibble to the LCD.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        This particular function is only used during initialization.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        byte = ((nibble &gt;&gt; <span class="number">4</span>) &amp; <span class="number">0x0f</span>) &lt;&lt; SHIFT_DATA</span><br><span class="line">        self.i2c.writeto(self.i2c_addr, <span class="built_in">bytearray</span>([byte | MASK_E]))</span><br><span class="line">        self.i2c.writeto(self.i2c_addr, <span class="built_in">bytearray</span>([byte]))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">hal_backlight_on</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Allows the hal layer to turn the backlight on.&quot;&quot;&quot;</span></span><br><span class="line">        self.i2c.writeto(self.i2c_addr, <span class="built_in">bytearray</span>([<span class="number">1</span> &lt;&lt; SHIFT_BACKLIGHT]))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">hal_backlight_off</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Allows the hal layer to turn the backlight off.&quot;&quot;&quot;</span></span><br><span class="line">        self.i2c.writeto(self.i2c_addr, <span class="built_in">bytearray</span>([<span class="number">0</span>]))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">hal_write_command</span>(<span class="params">self, cmd</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Writes a command to the LCD.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Data is latched on the falling edge of E.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        byte = ((self.backlight &lt;&lt; SHIFT_BACKLIGHT) | (((cmd &gt;&gt; <span class="number">4</span>) &amp; <span class="number">0x0f</span>) &lt;&lt; SHIFT_DATA))</span><br><span class="line">        self.i2c.writeto(self.i2c_addr, <span class="built_in">bytearray</span>([byte | MASK_E]))</span><br><span class="line">        self.i2c.writeto(self.i2c_addr, <span class="built_in">bytearray</span>([byte]))</span><br><span class="line">        byte = ((self.backlight &lt;&lt; SHIFT_BACKLIGHT) | ((cmd &amp; <span class="number">0x0f</span>) &lt;&lt; SHIFT_DATA))</span><br><span class="line">        self.i2c.writeto(self.i2c_addr, <span class="built_in">bytearray</span>([byte | MASK_E]))</span><br><span class="line">        self.i2c.writeto(self.i2c_addr, <span class="built_in">bytearray</span>([byte]))</span><br><span class="line">        <span class="keyword">if</span> cmd &lt;= <span class="number">3</span>:</span><br><span class="line">            <span class="comment"># The home and clear commands require a worst case delay of 4.1 msec</span></span><br><span class="line">            sleep_ms(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">hal_write_data</span>(<span class="params">self, data</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Write data to the LCD.&quot;&quot;&quot;</span></span><br><span class="line">        byte = (MASK_RS | (self.backlight &lt;&lt; SHIFT_BACKLIGHT) | (((data &gt;&gt; <span class="number">4</span>) &amp; <span class="number">0x0f</span>) &lt;&lt; SHIFT_DATA))</span><br><span class="line">        self.i2c.writeto(self.i2c_addr, <span class="built_in">bytearray</span>([byte | MASK_E]))</span><br><span class="line">        self.i2c.writeto(self.i2c_addr, <span class="built_in">bytearray</span>([byte]))</span><br><span class="line">        byte = (MASK_RS | (self.backlight &lt;&lt; SHIFT_BACKLIGHT) | ((data &amp; <span class="number">0x0f</span>) &lt;&lt; SHIFT_DATA))</span><br><span class="line">        self.i2c.writeto(self.i2c_addr, <span class="built_in">bytearray</span>([byte | MASK_E]))</span><br><span class="line">        self.i2c.writeto(self.i2c_addr, <span class="built_in">bytearray</span>([byte]))</span><br></pre></td></tr></table></figure>
<h3 id="实例-4">实例</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> machine <span class="keyword">import</span> SoftI2C, Pin</span><br><span class="line"><span class="keyword">from</span> esp32_i2c_1602lcd <span class="keyword">import</span> I2cLcd</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">DEFAULT_I2C_ADDR = <span class="number">0x27</span></span><br><span class="line">i2c = SoftI2C(sda=Pin(<span class="number">15</span>),scl=Pin(<span class="number">2</span>),freq=<span class="number">100000</span>)</span><br><span class="line">lcd = I2cLcd(i2c, DEFAULT_I2C_ADDR, <span class="number">2</span>, <span class="number">16</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">100</span>):</span><br><span class="line">    lcd.clear()</span><br><span class="line">    lcd.putstr(<span class="string">&quot;loading...&#123;&#125;\n&quot;</span>.<span class="built_in">format</span>(i))</span><br><span class="line">    lcd.putstr(<span class="string">&quot;zoujiahua&quot;</span>)</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># SDA GPIO15</span></span><br><span class="line"><span class="comment"># SCL GPIO2</span></span><br><span class="line"><span class="comment"># Vcc 5V （3V显示不清楚）</span></span><br><span class="line"><span class="comment"># GND GND</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="最终效果-5">最终效果</h3>
<p><img src="https://raw.githubusercontent.com/Center-cr/picture/main/202307290026778.png" alt="image-20230728220949189" style="zoom:50%;" /></p>
<h2 id="st7789240x240彩屏幕与spi">ST7789、240x240彩屏幕与SPI</h2>
<h3 id="接口">240*240接口</h3>
<figure>
<img
src="https://raw.githubusercontent.com/Center-cr/picture/main/202307290029583.png"
alt="image-20230728221151321" />
<figcaption aria-hidden="true">image-20230728221151321</figcaption>
</figure>
<h3 id="spi">SPI</h3>
<p><code>SPI</code>使用四根线实现快速数据通信，
理论上，<strong>SPI是一种全双工的通讯协议</strong></p>
<p><code>SPI</code>通讯无起始位和停止位，因此数据可以连续流传输而不会中断；没有像<code>I2C</code>这样的复杂的从站寻址系统，数据传输速率比<code>I2C</code>更高（几乎快两倍）。独立的<code>MISO</code>和<code>MOSI</code>线路，可以同时发送和接收数据。</p>
<p>在<code>SPI</code>协议中，设备分为<code>主机</code>与<code>从机</code>。主机是控制设备（通常是微控制器），而从机（通常是传感器，显示器或存储芯片）从主机那获取指令。</p>
<p>可以外接多个设备</p>
<p>其他制造商可能会遵循其他命名规则，但是最终他们指的相同的含义。以下是一些常用术语；</p>
<ul>
<li><strong>MISO</strong>也可以是SIMO，DOUT，DO，SDO或SO（在主机端）;</li>
<li><strong>MOSI</strong>也可以是SOMI，DIN，DI，SDI或SI（在主机端）;</li>
<li><strong>NSS</strong>也可以是CE，CS或SSEL;</li>
<li><strong>SCLK</strong>也可以是SCK;</li>
</ul>
<figure>
<img
src="https://raw.githubusercontent.com/Center-cr/picture/main/202307290029811.png"
alt="image-20230728222150040" />
<figcaption aria-hidden="true">image-20230728222150040</figcaption>
</figure>
<figure>
<img
src="https://raw.githubusercontent.com/Center-cr/picture/main/202307290030896.png"
alt="image-20230728222330503" />
<figcaption aria-hidden="true">image-20230728222330503</figcaption>
</figure>
<h3 id="驱动下载-1">驱动下载</h3>
<ul>
<li><code>st7789py.py</code>库：https://github.com/russhughes/st7789py_mpy</li>
</ul>
<p><a
target="_blank" rel="noopener" href="https://doc.itprojects.cn/0006.zhishi.esp32/02.doc/index.html#/10.240x240?id=_62-修复屏幕上述驱动不能显示的bug">修复屏幕上述驱动不能显示的bug</a></p>
<ul>
<li>下载st7789.py文件：https://doc.itprojects.cn/0006.zhishi.esp32/01.download/st7789.py</li>
<li>将<code>st7789py.py</code>文件中的
<code>204</code>、<code>205</code>行 注释</li>
</ul>
<h3 id="代替方案">代替方案</h3>
<ul>
<li>st7789.py：能够快速的驱动240x240屏幕，但功能少，不能显示图片</li>
<li>st7789py.py：能够显示图片、文字灯，但是每次重新上电后，屏幕容易不亮</li>
</ul>
<p>综上所有，对<code>st7789.py</code>进行了升级，添加图形库功能，这样一来就可以用一个文件，删除st7789py.py即可</p>
<p><a
target="_blank" rel="noopener" href="https://doc.itprojects.cn/0006.zhishi.esp32/02.doc/index.html#/11.240x240image?id=_22-新st7789py下载">2.2
新st7789.py下载</a></p>
<p>新 st7789（推荐用）</p>
<p>https://doc.itprojects.cn/0006.zhishi.esp32/01.download/new/st7789_itprojects.py</p>
<p>旧st7789（弃用，原因：ST7789芯片更新后添加了伽马值，导致彩色失真）</p>
<p>https://doc.itprojects.cn/0006.zhishi.esp32/01.download/st7789_itprojects.py</p>
<p>st7789.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ustruct</span><br><span class="line"><span class="keyword">import</span> utime</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">_NOP = const(<span class="number">0x00</span>)</span><br><span class="line">_SWRESET = const(<span class="number">0x01</span>)</span><br><span class="line">_RDDID = const(<span class="number">0x04</span>)</span><br><span class="line">_RDDST = const(<span class="number">0x09</span>)</span><br><span class="line"></span><br><span class="line">_SLPIN = const(<span class="number">0x10</span>)</span><br><span class="line">_SLPOUT = const(<span class="number">0x11</span>)</span><br><span class="line">_PTLON = const(<span class="number">0x12</span>)</span><br><span class="line">_NORON = const(<span class="number">0x13</span>)</span><br><span class="line"></span><br><span class="line">_INVOFF = const(<span class="number">0x20</span>)</span><br><span class="line">_INVON = const(<span class="number">0x21</span>)</span><br><span class="line">_DISPOFF = const(<span class="number">0x28</span>)</span><br><span class="line">_DISPON = const(<span class="number">0x29</span>)</span><br><span class="line">_CASET = const(<span class="number">0x2A</span>)</span><br><span class="line">_RASET = const(<span class="number">0x2B</span>)</span><br><span class="line">_RAMWR = const(<span class="number">0x2C</span>)</span><br><span class="line">_RAMRD = const(<span class="number">0x2E</span>)</span><br><span class="line"></span><br><span class="line">_PTLAR = const(<span class="number">0x30</span>)</span><br><span class="line">_COLMOD = const(<span class="number">0x3A</span>)</span><br><span class="line">_MADCTL = const(<span class="number">0x36</span>)</span><br><span class="line"></span><br><span class="line">_FRMCTR1 = const(<span class="number">0xB1</span>)</span><br><span class="line">_FRMCTR2 = const(<span class="number">0xB2</span>)</span><br><span class="line">_FRMCTR3 = const(<span class="number">0xB3</span>)</span><br><span class="line">_INVCTR = const(<span class="number">0xB4</span>)</span><br><span class="line">_DISSET5 = const(<span class="number">0xB6</span>)</span><br><span class="line">_GCTRL = const(<span class="number">0xB7</span>)</span><br><span class="line">_VCOMS  =  const(<span class="number">0xBB</span>)</span><br><span class="line">_FRCTR2 = const(<span class="number">0xC6</span>)</span><br><span class="line">_D6H = const(<span class="number">0xD6</span>)</span><br><span class="line">_PWCTRL1 = const(<span class="number">0xD0</span>)</span><br><span class="line">_GATECTRL = const(<span class="number">0xE4</span>)</span><br><span class="line"></span><br><span class="line">_PWCTR1 = const(<span class="number">0xC0</span>)</span><br><span class="line">_PWCTR2 = const(<span class="number">0xC1</span>)</span><br><span class="line">_PWCTR3 = const(<span class="number">0xC2</span>)</span><br><span class="line">_PWCTR4 = const(<span class="number">0xC3</span>)</span><br><span class="line">_PWCTR5 = const(<span class="number">0xC4</span>)</span><br><span class="line">_VMCTR1 = const(<span class="number">0xC5</span>)</span><br><span class="line"></span><br><span class="line">_RDID1 = const(<span class="number">0xDA</span>)</span><br><span class="line">_RDID2 = const(<span class="number">0xDB</span>)</span><br><span class="line">_RDID3 = const(<span class="number">0xDC</span>)</span><br><span class="line">_RDID4 = const(<span class="number">0xDD</span>)</span><br><span class="line"></span><br><span class="line">_PWCTR6 = const(<span class="number">0xFC</span>)</span><br><span class="line"></span><br><span class="line">_GMCTRP1 = const(<span class="number">0xE0</span>)</span><br><span class="line">_GMCTRN1 = const(<span class="number">0xE1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">color565</span>(<span class="params">r, g, b</span>):</span><br><span class="line">    <span class="keyword">return</span> (r &amp; <span class="number">0xf8</span>) &lt;&lt; <span class="number">8</span> | (g &amp; <span class="number">0xfc</span>) &lt;&lt; <span class="number">3</span> | b &gt;&gt; <span class="number">3</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DummyPin</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;A fake gpio pin for when you want to skip pins.&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    OUT = <span class="number">0</span></span><br><span class="line">    IN = <span class="number">0</span></span><br><span class="line">    PULL_UP = <span class="number">0</span></span><br><span class="line">    PULL_DOWN = <span class="number">0</span></span><br><span class="line">    OPEN_DRAIN = <span class="number">0</span></span><br><span class="line">    ALT = <span class="number">0</span></span><br><span class="line">    ALT_OPEN_DRAIN = <span class="number">0</span></span><br><span class="line">    LOW_POWER = <span class="number">0</span></span><br><span class="line">    MED_POWER = <span class="number">0</span></span><br><span class="line">    HIGH_PWER = <span class="number">0</span></span><br><span class="line">    IRQ_FALLING = <span class="number">0</span></span><br><span class="line">    IRQ_RISING = <span class="number">0</span></span><br><span class="line">    IRQ_LOW_LEVEL = <span class="number">0</span></span><br><span class="line">    IRQ_HIGH_LEVEL = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__call__</span>(<span class="params">self, *args, **kwargs</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    init = __call__</span><br><span class="line">    value = __call__</span><br><span class="line">    out_value = __call__</span><br><span class="line">    toggle = __call__</span><br><span class="line">    high = __call__</span><br><span class="line">    low = __call__</span><br><span class="line">    on = __call__</span><br><span class="line">    off = __call__</span><br><span class="line">    mode = __call__</span><br><span class="line">    pull = __call__</span><br><span class="line">    drive = __call__</span><br><span class="line">    irq = __call__</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Display</span>:</span><br><span class="line">    _PAGE_SET = <span class="literal">None</span></span><br><span class="line">    _COLUMN_SET = <span class="literal">None</span></span><br><span class="line">    _RAM_WRITE = <span class="literal">None</span></span><br><span class="line">    _RAM_READ = <span class="literal">None</span></span><br><span class="line">    _INIT = ()</span><br><span class="line">    _ENCODE_PIXEL = <span class="string">&quot;&gt;H&quot;</span></span><br><span class="line">    _ENCODE_POS = <span class="string">&quot;&gt;HH&quot;</span></span><br><span class="line">    _DECODE_PIXEL = <span class="string">&quot;&gt;BBB&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, width, height</span>):</span><br><span class="line">        self.width = width</span><br><span class="line">        self.height = height</span><br><span class="line">        self.init()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">init</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Run the initialization commands.&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">for</span> command, data <span class="keyword">in</span> self._INIT:</span><br><span class="line">            self._write(command, data)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_block</span>(<span class="params">self, x0, y0, x1, y1, data=<span class="literal">None</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Read or write a block of data.&quot;&quot;&quot;</span></span><br><span class="line">        self._write(self._COLUMN_SET, self._encode_pos(x0, x1))</span><br><span class="line">        self._write(self._PAGE_SET, self._encode_pos(y0+<span class="number">80</span>, y1+<span class="number">80</span>))</span><br><span class="line">        <span class="keyword">if</span> data <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            size = ustruct.calcsize(self._DECODE_PIXEL)</span><br><span class="line">            <span class="keyword">return</span> self._read(self._RAM_READ, (x1 - x0 + <span class="number">1</span>) * (y1 - y0 + <span class="number">1</span>) * size)</span><br><span class="line">    </span><br><span class="line">        self._write(self._RAM_WRITE, data)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_encode_pos</span>(<span class="params">self, a, b</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Encode a postion into bytes.&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> ustruct.pack(self._ENCODE_POS, a, b)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_encode_pixel</span>(<span class="params">self, color</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Encode a pixel color into bytes.&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> ustruct.pack(self._ENCODE_PIXEL, color)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_decode_pixel</span>(<span class="params">self, data</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Decode bytes into a pixel color.&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> color565(*ustruct.unpack(self._DECODE_PIXEL, data))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">pixel</span>(<span class="params">self, x, y, color=<span class="literal">None</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Read or write a pixel.&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> color <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> self._decode_pixel(self._block(x, y, x, y))</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="number">0</span> &lt;= x &lt; self.width <span class="keyword">or</span> <span class="keyword">not</span> <span class="number">0</span> &lt;= y &lt; self.height:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        self._block(x, y, x, y, self._encode_pixel(color))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">fill_rectangle</span>(<span class="params">self, x, y, width, height, color</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Draw a filled rectangle.&quot;&quot;&quot;</span></span><br><span class="line">        x = <span class="built_in">min</span>(self.width - <span class="number">1</span>, <span class="built_in">max</span>(<span class="number">0</span>, x))</span><br><span class="line">        y = <span class="built_in">min</span>(self.height - <span class="number">1</span>, <span class="built_in">max</span>(<span class="number">0</span>, y))</span><br><span class="line">        w = <span class="built_in">min</span>(self.width - x, <span class="built_in">max</span>(<span class="number">1</span>, width))</span><br><span class="line">        h = <span class="built_in">min</span>(self.height - y, <span class="built_in">max</span>(<span class="number">1</span>, height))</span><br><span class="line">        self._block(x, y, x + w - <span class="number">1</span>, y + h - <span class="number">1</span>, <span class="string">b&#x27;&#x27;</span>)</span><br><span class="line">        chunks, rest = <span class="built_in">divmod</span>(w * h, <span class="number">512</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;color:&quot;</span>, color)</span><br><span class="line">        pixel = self._encode_pixel(color)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;decode:&quot;</span>, pixel)</span><br><span class="line">        <span class="keyword">if</span> chunks:</span><br><span class="line">            data = pixel * <span class="number">512</span></span><br><span class="line">            <span class="keyword">for</span> count <span class="keyword">in</span> <span class="built_in">range</span>(chunks):</span><br><span class="line">                self._write(<span class="literal">None</span>, data)</span><br><span class="line">        <span class="keyword">if</span> rest:</span><br><span class="line">            self._write(<span class="literal">None</span>, pixel * rest)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">fill</span>(<span class="params">self, color=<span class="number">0</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Fill whole screen.&quot;&quot;&quot;</span></span><br><span class="line">        self.fill_rectangle(<span class="number">0</span>, <span class="number">0</span>, self.width, self.height, color)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">hline</span>(<span class="params">self, x, y, width, color</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Draw a horizontal line.&quot;&quot;&quot;</span></span><br><span class="line">        self.fill_rectangle(x, y, width, <span class="number">1</span>, color)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">vline</span>(<span class="params">self, x, y, height, color</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Draw a vertical line.&quot;&quot;&quot;</span></span><br><span class="line">        self.fill_rectangle(x, y, <span class="number">1</span>, height, color)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">blit_buffer</span>(<span class="params">self, buffer, x, y, width, height</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Copy pixels from a buffer.&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">not</span> <span class="number">0</span> &lt;= x &lt; self.width <span class="keyword">or</span></span><br><span class="line">            <span class="keyword">not</span> <span class="number">0</span> &lt;= y &lt; self.height <span class="keyword">or</span></span><br><span class="line">            <span class="keyword">not</span> <span class="number">0</span> &lt; x + width &lt;= self.width <span class="keyword">or</span></span><br><span class="line">            <span class="keyword">not</span> <span class="number">0</span> &lt; y + height &lt;= self.height):</span><br><span class="line">                <span class="keyword">raise</span> ValueError(<span class="string">&quot;out of bounds&quot;</span>)</span><br><span class="line">        self._block(x, y, x + width - <span class="number">1</span>, y + height - <span class="number">1</span>, buffer)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DisplaySPI</span>(<span class="title class_ inherited__">Display</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, spi, dc, cs=<span class="literal">None</span>, rst=<span class="literal">None</span>, width=<span class="number">1</span>, height=<span class="number">1</span></span>):</span><br><span class="line">        self.spi = spi</span><br><span class="line">        self.cs = cs</span><br><span class="line">        self.dc = dc</span><br><span class="line">        self.rst = rst</span><br><span class="line">        <span class="keyword">if</span> self.rst <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            self.rst = DummyPin()</span><br><span class="line">        <span class="keyword">if</span> self.cs <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            self.cs = DummyPin()</span><br><span class="line">        self.cs.init(self.cs.OUT, value=<span class="number">1</span>)</span><br><span class="line">        self.dc.init(self.dc.OUT, value=<span class="number">0</span>)</span><br><span class="line">        self.rst.init(self.rst.OUT, value=<span class="number">1</span>)</span><br><span class="line">        self.reset()</span><br><span class="line">        <span class="built_in">super</span>().__init__(width, height)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">reset</span>(<span class="params">self</span>):</span><br><span class="line">        self.rst(<span class="number">0</span>)</span><br><span class="line">        utime.sleep_ms(<span class="number">50</span>)</span><br><span class="line">        self.rst(<span class="number">1</span>)</span><br><span class="line">        utime.sleep_ms(<span class="number">50</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_write</span>(<span class="params">self, command=<span class="literal">None</span>, data=<span class="literal">None</span></span>):</span><br><span class="line">        <span class="keyword">if</span> command <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            self.dc(<span class="number">0</span>)</span><br><span class="line">            self.cs(<span class="number">0</span>)</span><br><span class="line">            self.spi.write(<span class="built_in">bytearray</span>([command]))</span><br><span class="line">            self.cs(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">if</span> data:</span><br><span class="line">            self.dc(<span class="number">1</span>)</span><br><span class="line">            self.cs(<span class="number">0</span>)</span><br><span class="line">            self.spi.write(data)</span><br><span class="line">            self.cs(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_read</span>(<span class="params">self, command=<span class="literal">None</span>, count=<span class="number">0</span></span>):</span><br><span class="line">        self.dc(<span class="number">0</span>)</span><br><span class="line">        self.cs(<span class="number">0</span>)</span><br><span class="line">        <span class="keyword">if</span> command <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            self.spi.write(<span class="built_in">bytearray</span>([command]))</span><br><span class="line">        <span class="keyword">if</span> count:</span><br><span class="line">            data = self.spi.read(count)</span><br><span class="line">        self.cs(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ST7789</span>(<span class="title class_ inherited__">DisplaySPI</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    A simple driver for the ST7789-based displays.</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; from machine import Pin, SPI</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; import st7789</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; display = st7789.ST7789(SPI(1), dc=Pin(12), cs=Pin(15), rst=Pin(16))</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; display = st7789.ST7789R(SPI(1, baudrate=40000000), dc=Pin(12), cs=Pin(15), rst=Pin(16))</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; display.fill(0x7521)</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; display.pixel(64, 64, 0)</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    _COLUMN_SET = _CASET</span><br><span class="line">    _PAGE_SET = _RASET</span><br><span class="line">    _RAM_WRITE = _RAMWR</span><br><span class="line">    _RAM_READ = _RAMRD</span><br><span class="line">    _INIT = (</span><br><span class="line">        (_SWRESET, <span class="literal">None</span>),</span><br><span class="line">        (_SLPOUT, <span class="literal">None</span>),</span><br><span class="line">        (_COLMOD, <span class="string">b&quot;\x55&quot;</span>),  <span class="comment"># 16bit color</span></span><br><span class="line">        (_MADCTL, <span class="string">b&quot;\x08&quot;</span>),</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, spi, dc, cs, rst=<span class="literal">None</span>, width=<span class="number">240</span>, height=<span class="number">240</span></span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__(spi, dc, cs, rst, width, height)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">init</span>(<span class="params">self</span>):</span><br><span class="line"></span><br><span class="line">        <span class="built_in">super</span>().init()</span><br><span class="line">        cols = ustruct.pack(<span class="string">&quot;&gt;HH&quot;</span>, <span class="number">0</span>, self.width)</span><br><span class="line">        rows = ustruct.pack(<span class="string">&quot;&gt;HH&quot;</span>, <span class="number">0</span>, self.height)</span><br><span class="line">        <span class="comment"># ctr2p= ustruct.pack(&quot;&gt;BBBBB&quot;, b&quot;\x1F\x1F\x00\x33\x33&quot;)</span></span><br><span class="line">        ctr2p= <span class="string">b&quot;\x1F\x1F\x00\x33\x33&quot;</span></span><br><span class="line">        <span class="comment"># ctr1p= ustruct.pack(&quot;&gt;BB&quot;, b&quot;\xA4\xA1&quot;)</span></span><br><span class="line">        ctr1p= <span class="string">b&quot;\xA4\xA1&quot;</span></span><br><span class="line">        <span class="comment"># e0p= ustruct.pack(&quot;&gt;BBBBBBBBBBBBBB&quot;, b&quot;\xF0\x08\x0E\x09\x08\x04\x2F\x33\x45\x36\x13\x12\x2A\x2D&quot;)</span></span><br><span class="line">        e0p= <span class="string">b&quot;\xF0\x08\x0E\x09\x08\x04\x2F\x33\x45\x36\x13\x12\x2A\x2D&quot;</span></span><br><span class="line">        <span class="comment"># e1p= ustruct.pack(&quot;&gt;BBBBBBBBBBBBBB&quot;, b&quot;\xF0\x0E\x12\x0C\x0A\x15\x2E\x32\x44\x39\x17\x18\x2B\x2F&quot;)</span></span><br><span class="line">        e1p= <span class="string">b&quot;\xF0\x0E\x12\x0C\x0A\x15\x2E\x32\x44\x39\x17\x18\x2B\x2F&quot;</span></span><br><span class="line">        <span class="comment"># gatep= ustruct.pack(&quot;&gt;BBB&quot;, b&quot;\x1d\x00\x00&quot;)</span></span><br><span class="line">        gatep= <span class="string">b&quot;\x1d\x00\x00&quot;</span></span><br><span class="line">        <span class="keyword">for</span> command, data <span class="keyword">in</span> (</span><br><span class="line">            (_CASET, cols),</span><br><span class="line">            (_RASET, rows),</span><br><span class="line">            (_FRMCTR2,ctr2p),</span><br><span class="line">            (_GCTRL, <span class="string">b&quot;\x00&quot;</span>),</span><br><span class="line">            (_VCOMS, <span class="string">b&quot;\x36&quot;</span>),</span><br><span class="line">            (_PWCTR3, <span class="string">b&quot;\x01&quot;</span>),</span><br><span class="line">            (_PWCTR4, <span class="string">b&quot;\x13&quot;</span>),</span><br><span class="line">            (_PWCTR5, <span class="string">b&quot;\x20&quot;</span>),</span><br><span class="line">            (_FRCTR2, <span class="string">b&quot;\x13&quot;</span>),</span><br><span class="line">            (_D6H, <span class="string">b&quot;\xA1&quot;</span>),</span><br><span class="line">            (_PWCTRL1, ctr1p),</span><br><span class="line">            (_GMCTRP1, e0p),</span><br><span class="line">            (_GMCTRN1, e1p),</span><br><span class="line">            (_GATECTRL, gatep),</span><br><span class="line">            (_INVON, <span class="literal">None</span>),</span><br><span class="line">            (_NORON, <span class="literal">None</span>),</span><br><span class="line">            (_DISPON, <span class="literal">None</span>),</span><br><span class="line">            (_MADCTL, <span class="string">b&quot;\xc0&quot;</span>),  <span class="comment"># Set rotation to 0 and use RGB</span></span><br><span class="line">        ):</span><br><span class="line">            self._write(command, data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ST7889_Image</span>(<span class="title class_ inherited__">ST7789</span>):</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_set_columns</span>(<span class="params">self, start, end</span>):</span><br><span class="line">        <span class="keyword">if</span> start &lt;= end:</span><br><span class="line">            self._write(_CASET, self._encode_pos(start, end))</span><br><span class="line">            </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_set_rows</span>(<span class="params">self, start, end</span>):</span><br><span class="line">        <span class="keyword">if</span> start &lt;= end:</span><br><span class="line">            self._write(_RASET, self._encode_pos(start, end))</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_set_window</span>(<span class="params">self, x0, y0, x1, y1</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        x0锛� x璧峰浣嶇疆</span></span><br><span class="line"><span class="string">        y0:  y璧峰浣嶇疆</span></span><br><span class="line"><span class="string">        x1:  x缁撴潫浣嶇疆</span></span><br><span class="line"><span class="string">        y1:  y缁撴潫浣嶇疆</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        self._set_columns(x0, x1)</span><br><span class="line">        self._set_rows(y0, y1)</span><br><span class="line">        self._write(_RAMWR)</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">show_img</span>(<span class="params">self, x0, y0, x1, y1, img_data</span>):</span><br><span class="line">        self._set_window(x0, y0 + <span class="number">80</span>, x1, y1 + <span class="number">80</span>)</span><br><span class="line">        self._write(<span class="literal">None</span>, img_data)</span><br><span class="line">    </span><br></pre></td></tr></table></figure>
<h3 id="实例-打印-hello">实例-打印 "hello "</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> machine <span class="keyword">import</span> Pin, SPI</span><br><span class="line"><span class="keyword">import</span> ST7789 <span class="keyword">as</span> st7789</span><br><span class="line"><span class="keyword">import</span> st7789py</span><br><span class="line"><span class="keyword">from</span> romfonts <span class="keyword">import</span> vga2_bold_16x32 <span class="keyword">as</span> font</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 解决第1次启动时，不亮的问题</span></span><br><span class="line">st7789.ST7789(SPI(<span class="number">2</span>, <span class="number">60000000</span>), dc=Pin(<span class="number">2</span>), cs=Pin(<span class="number">5</span>), rst=Pin(<span class="number">15</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建显示屏对象</span></span><br><span class="line">tft = st7789py.ST7789(SPI(<span class="number">2</span>, <span class="number">60000000</span>), <span class="number">240</span>, <span class="number">240</span>, reset=Pin(<span class="number">15</span>), dc=Pin(<span class="number">2</span>), cs=Pin(<span class="number">5</span>), rotation=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 屏幕显示蓝色</span></span><br><span class="line">tft.fill(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示Hello</span></span><br><span class="line">tft.text(font, <span class="string">&quot;Hello&quot;</span>, <span class="number">0</span>, <span class="number">0</span>, st7789py.color565(<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>), st7789py.color565(<span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>))</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">def show_text():</span></span><br><span class="line"><span class="string">    for rotation in range(4):</span></span><br><span class="line"><span class="string">        tft.rotation(rotation)</span></span><br><span class="line"><span class="string">        tft.fill(0)</span></span><br><span class="line"><span class="string">        col_max = tft.width - font.WIDTH*6</span></span><br><span class="line"><span class="string">        row_max = tft.height - font.HEIGHT</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        for _ in range(100):</span></span><br><span class="line"><span class="string">            tft.text(</span></span><br><span class="line"><span class="string">                font,</span></span><br><span class="line"><span class="string">                &quot;Hello!&quot;,</span></span><br><span class="line"><span class="string">                random.randint(0, col_max),</span></span><br><span class="line"><span class="string">                random.randint(0, row_max),</span></span><br><span class="line"><span class="string">                st7789py.color565(random.getrandbits(8),random.getrandbits(8),random.getrandbits(8)),</span></span><br><span class="line"><span class="string">                st7789py.color565(random.getrandbits(8),random.getrandbits(8),random.getrandbits(8))</span></span><br><span class="line"><span class="string">            )</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 随机显示Hello!</span></span><br><span class="line"><span class="string"># while True:</span></span><br><span class="line"><span class="string">#    show_text()</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="最终效果-打印-hello">最终效果-打印 "hello "</h3>
<p><img src="https://raw.githubusercontent.com/Center-cr/picture/main/202307290029564.png" alt="image-20230729002824921" style="zoom:33%;" /></p>
<h3 id="实例-打印图片">实例-打印图片</h3>
<p>由于图片过大，需要将图片转为 dat 格式 ，并上传 esp32</p>
<h4 id="第一步-在本地转化格式">第一步, 在本地转化格式</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">color565</span>(<span class="params">r, g, b</span>):</span><br><span class="line">    <span class="keyword">return</span> (r &amp; <span class="number">0xf8</span>) &lt;&lt; <span class="number">8</span> | (g &amp; <span class="number">0xfc</span>) &lt;&lt; <span class="number">3</span> | b &gt;&gt; <span class="number">3</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    img = Image.<span class="built_in">open</span>(<span class="string">&quot;test1.png&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(img.<span class="built_in">format</span>, img.size, img.mode)</span><br><span class="line">    img_data = np.array(img) </span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;text_img.dat&quot;</span>, <span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> img_data:</span><br><span class="line">            <span class="keyword">for</span> dot <span class="keyword">in</span> line:</span><br><span class="line">                f.write(struct.pack(<span class="string">&quot;H&quot;</span>, color565(*dot))[::-<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="第二步-micropython-开启tcp-服务作为服务端">第二步 ， micropython
开启TCP 服务作为服务端</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> network</span><br><span class="line"><span class="keyword">import</span> machine</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">do_connect</span>():</span><br><span class="line">    wlan = network.WLAN(network.STA_IF)</span><br><span class="line">    wlan.active(<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> wlan.isconnected():</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;connecting to network...&#x27;</span>)</span><br><span class="line">        wlan.connect(<span class="string">&#x27;dongfeiqiu&#x27;</span>, <span class="string">&#x27;wangmingdong1225&#x27;</span>)</span><br><span class="line">        i = <span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">not</span> wlan.isconnected():</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;姝ｅ湪閾炬帴...&#123;&#125;&quot;</span>.<span class="built_in">format</span>(i))</span><br><span class="line">            i += <span class="number">1</span></span><br><span class="line">            time.sleep(<span class="number">1</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;network config:&#x27;</span>, wlan.ifconfig())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 0. 连接wifi</span></span><br><span class="line">do_connect()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.建立 TCP 服务端对象</span></span><br><span class="line">server_s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 绑定本地信息</span></span><br><span class="line">server_s.bind((<span class="string">&quot;&quot;</span>, <span class="number">8080</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 最大接收</span></span><br><span class="line">server_s.listen(<span class="number">128</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;等待连接...&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 接收客户端身份信息</span></span><br><span class="line">new_s, client_info = server_s.accept()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;等待客户端请求...&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 鍒涘缓鏂囦欢锛屾帴鏀舵暟鎹�</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;text_img.dat&quot;</span>, <span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">240</span>):</span><br><span class="line">        <span class="comment"># 3.1 就收dat</span></span><br><span class="line">        data = new_s.recv(<span class="number">480</span>)  <span class="comment"># 240*2=480 </span></span><br><span class="line">        <span class="comment"># 3.2 写入写入</span></span><br><span class="line">        f.write(data)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;接收第%d个数据&quot;</span> % (i+<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;接收完成&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 7.关闭TCP 服务</span></span><br><span class="line">new_s.close()</span><br><span class="line">server_s.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4
id="第三步本地客户端上传转化后的数据给-esp32">第三步本地客户端上传转化后的数据给
esp32</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 创建客户端</span></span><br><span class="line">tcp_client_socket = socket(AF_INET, SOCK_STREAM)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 绑定服务端信息</span></span><br><span class="line">tcp_client_socket.connect((<span class="string">&quot;192.168.126.132&quot;</span>, <span class="number">8080</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 发送图片数据</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;text_img.dat&quot;</span>, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">240</span>):</span><br><span class="line">        <span class="comment"># 3.1 读取</span></span><br><span class="line">        data = f.read(<span class="number">480</span>)</span><br><span class="line">        <span class="comment"># 3.2 发送</span></span><br><span class="line">        tcp_client_socket.send(data)  <span class="comment"># 240*2=480 涓€琛屾湁240涓偣锛屾瘡涓偣鏈�2涓瓧鑺�</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;发送第%d个数据&quot;</span> % (i + <span class="number">1</span>))</span><br><span class="line">        <span class="comment"># time.sleep(0.5)</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;发送完成&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 7. 关闭 TCP 客户端</span></span><br><span class="line">tcp_client_socket.close()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="第四步-esp32-显示图片">第四步-esp32 显示图片</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> machine <span class="keyword">import</span> Pin, SPI</span><br><span class="line"><span class="keyword">import</span> st7789 <span class="keyword">as</span> st7789_itprojects</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">tft = st7789_itprojects.ST7889_Image(SPI(<span class="number">2</span>, <span class="number">60000000</span>), dc=Pin(<span class="number">2</span>), cs=Pin(<span class="number">5</span>), rst=Pin(<span class="number">15</span>))</span><br><span class="line">tft.fill(st7789_itprojects.color565(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>))  <span class="comment"># 背景设置为黑色</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show_img</span>():</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;text_img.dat&quot;</span>, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">for</span> row <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">240</span>):</span><br><span class="line">            buffer = f.read(<span class="number">480</span>)</span><br><span class="line">            tft.show_img(<span class="number">0</span>, row, <span class="number">239</span>, row, buffer)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">show_img()</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="最终效果-打印图片">最终效果-打印图片</h4>
<figure>
<img
src="https://raw.githubusercontent.com/Center-cr/picture/main/202307290029448.png"
alt="image-20230729001850387" />
<figcaption aria-hidden="true">image-20230729001850387</figcaption>
</figure>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://example.com">Center-cr</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2023/07/24/%E5%8D%95%E7%89%87%E6%9C%BA/micropython+esp32/">http://example.com/2023/07/24/%E5%8D%95%E7%89%87%E6%9C%BA/micropython+esp32/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">Center-cr's Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/esp32/">esp32</a></div><div class="post_share"><div class="social-share" data-image="https://raw.githubusercontent.com/Center-cr/picture/main/202307240038038.webp" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="/pluginsSrc/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="/pluginsSrc/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/07/30/%E7%BD%91%E7%AB%99%E6%90%AD%E5%BB%BA/hexo%E5%85%A8%E5%B1%80%E9%9F%B3%E4%B9%90%E5%90%B8%E5%BA%95/" title="hexo全局音乐吸底"><img class="cover" src="https://raw.githubusercontent.com/Center-cr/picture/main/202307091525476.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">hexo全局音乐吸底</div></div></a></div><div class="next-post pull-right"><a href="/2023/07/23/%E7%BD%91%E7%AB%99%E6%90%AD%E5%BB%BA/hexo%20pdf%E9%A2%84%E8%A7%88/" title="hexo pdf预览"><img class="cover" src="https://raw.githubusercontent.com/Center-cr/picture/main/202307091525476.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">hexo pdf预览</div></div></a></div></nav><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="gitalk-container"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8F%8F%E8%BF%B0"><span class="toc-text">描述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%99%E7%A8%8B"><span class="toc-text">教程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#esp-32-%E7%94%B5%E8%B7%AF%E5%9B%BE"><span class="toc-text">esp 32 电路图</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#esp332-%E6%8A%80%E6%9C%AF%E8%A7%84%E6%A0%BC%E4%B9%A6"><span class="toc-text">esp332 技术规格书</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-text">开发环境搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#thonny-%E4%B8%8B%E8%BD%BD"><span class="toc-text">1. Thonny 下载</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#micropython-%E4%B8%8B%E8%BD%BD"><span class="toc-text">2. micropython 下载</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A9%B1%E5%8A%A8%E4%B8%8B%E8%BD%BD"><span class="toc-text">3. 驱动下载</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%83%A7%E5%BD%95micropython%E5%88%B0eps32"><span class="toc-text">4. 烧录MicroPython到EPS32</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%82%B9%E4%BA%AE-led-%E7%81%AF"><span class="toc-text">点亮 LED 灯</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pwm-%E5%91%BC%E5%90%B8%E7%81%AF"><span class="toc-text">PWM 呼吸灯</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%98%E6%96%B9%E4%BE%8B%E7%A8%8B"><span class="toc-text">官方例程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E4%BE%8B"><span class="toc-text">实例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%AE%E5%BA%A6"><span class="toc-text">亮度</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%91%BC%E5%90%B8%E7%81%AF"><span class="toc-text">呼吸灯</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%93%BE%E6%8E%A5-wifi"><span class="toc-text">链接 Wifi</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%98%E6%96%B9%E7%A4%BA%E4%BE%8B"><span class="toc-text">官方示例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E4%BE%8B-1"><span class="toc-text">实例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B1%80%E5%9F%9F%E7%BD%91udp%E9%93%BE%E6%8E%A5"><span class="toc-text">局域网UDP链接</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#esp32-%E5%8F%91%E9%80%81-hello-world-%E7%BB%99pc"><span class="toc-text">ESP32 发送 “hello world ” 给PC</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%80%E7%BB%88%E6%95%88%E6%9E%9C"><span class="toc-text">最终效果</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#pc-%E5%8F%91%E9%80%81-nice-to-meey-you-%E7%BB%99-esp32"><span class="toc-text">PC 发送 “nice to meey you ”
给 ESP32</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%80%E7%BB%88%E6%95%88%E6%9E%9C-1"><span class="toc-text">最终效果</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pc-%E6%8E%A7%E5%88%B6-led-%E7%81%AF"><span class="toc-text">PC 控制 LED 灯</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E4%BE%8B-2"><span class="toc-text">实例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%80%E7%BB%88%E6%95%88%E6%9E%9C-2"><span class="toc-text">最终效果</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E7%A0%81%E7%AE%A1%E6%98%BE%E7%A4%BA"><span class="toc-text">数码管显示</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%A2%E5%8C%85%E6%9D%BF%E4%BD%BF%E7%94%A8"><span class="toc-text">面包板使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B1%E9%98%B4%E6%95%B0%E7%A0%81%E7%AE%A1"><span class="toc-text">共阴数码管</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%97%AE%E9%A2%98"><span class="toc-text">问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%80%E7%BB%88%E6%95%88%E6%9E%9C-3"><span class="toc-text">最终效果</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E4%BD%8D%E6%95%B0%E6%95%B0%E7%A0%81%E7%AE%A1%E6%98%BE%E7%A4%BA"><span class="toc-text">四位数数码管显示</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E4%BE%8B-3"><span class="toc-text">实例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%80%E7%BB%88%E6%95%88%E6%9E%9C-4"><span class="toc-text">最终效果</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#lcd%E4%B8%8Ei2c"><span class="toc-text">1602LCD与I2C</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#lcd"><span class="toc-text">1602LCD</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#i2c"><span class="toc-text">I2C</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#pcf8574"><span class="toc-text">PCF8574</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#micropython%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3iic"><span class="toc-text">Micropython官方文档（IIC）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9C%80%E8%A6%81%E7%9A%84api%E9%A9%B1%E5%8A%A8%E6%A8%A1%E5%9D%97"><span class="toc-text">需要的api、驱动模块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E4%BE%8B-4"><span class="toc-text">实例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%80%E7%BB%88%E6%95%88%E6%9E%9C-5"><span class="toc-text">最终效果</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#st7789240x240%E5%BD%A9%E5%B1%8F%E5%B9%95%E4%B8%8Espi"><span class="toc-text">ST7789、240x240彩屏幕与SPI</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3"><span class="toc-text">240*240接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#spi"><span class="toc-text">SPI</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A9%B1%E5%8A%A8%E4%B8%8B%E8%BD%BD-1"><span class="toc-text">驱动下载</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E6%9B%BF%E6%96%B9%E6%A1%88"><span class="toc-text">代替方案</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E4%BE%8B-%E6%89%93%E5%8D%B0-hello"><span class="toc-text">实例-打印 &quot;hello &quot;</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%80%E7%BB%88%E6%95%88%E6%9E%9C-%E6%89%93%E5%8D%B0-hello"><span class="toc-text">最终效果-打印 &quot;hello &quot;</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E4%BE%8B-%E6%89%93%E5%8D%B0%E5%9B%BE%E7%89%87"><span class="toc-text">实例-打印图片</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E6%AD%A5-%E5%9C%A8%E6%9C%AC%E5%9C%B0%E8%BD%AC%E5%8C%96%E6%A0%BC%E5%BC%8F"><span class="toc-text">第一步, 在本地转化格式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E6%AD%A5-micropython-%E5%BC%80%E5%90%AFtcp-%E6%9C%8D%E5%8A%A1%E4%BD%9C%E4%B8%BA%E6%9C%8D%E5%8A%A1%E7%AB%AF"><span class="toc-text">第二步 ， micropython
开启TCP 服务作为服务端</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E6%AD%A5%E6%9C%AC%E5%9C%B0%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%B8%8A%E4%BC%A0%E8%BD%AC%E5%8C%96%E5%90%8E%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%99-esp32"><span class="toc-text">第三步本地客户端上传转化后的数据给
esp32</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E5%9B%9B%E6%AD%A5-esp32-%E6%98%BE%E7%A4%BA%E5%9B%BE%E7%89%87"><span class="toc-text">第四步-esp32 显示图片</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%80%E7%BB%88%E6%95%88%E6%9E%9C-%E6%89%93%E5%8D%B0%E5%9B%BE%E7%89%87"><span class="toc-text">最终效果-打印图片</span></a></li></ol></li></ol></li></ol></div></div></div></div></main><footer id="footer" style="background-image: url('https://raw.githubusercontent.com/Center-cr/picture/main/202307240038038.webp')"><div id="footer-wrap"></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/pluginsSrc/@fancyapps/ui/dist/fancybox/fancybox.umd.js"></script><script src="/pluginsSrc/instant.page/instantpage.js" type="module"></script><div class="js-pjax"><script>function loadGitalk () {
  function initGitalk () {
    var gitalk = new Gitalk(Object.assign({
      clientID: '0b46f2c6ec014d6d94b7',
      clientSecret: '2898008e1b0c5fc2a1119c65b2ef15dd09826304',
      repo: 'Center-cr.github.io',
      owner: 'Center-cr',
      admin: ['Center-cr'],
      id: '4532fac960abe2298054779e2b828bad',
      updateCountCallback: commentCount
    },null))

    gitalk.render('gitalk-container')
  }

  if (typeof Gitalk === 'function') initGitalk()
  else {
    getCSS('/pluginsSrc/gitalk/dist/gitalk.css')
    getScript('/pluginsSrc/gitalk/dist/gitalk.min.js').then(initGitalk)
  }
}

function commentCount(n){
  let isCommentCount = document.querySelector('#post-meta .gitalk-comment-count')
  if (isCommentCount) {
    isCommentCount.textContent= n
  }
}

if ('Gitalk' === 'Gitalk' || !false) {
  if (false) btf.loadComment(document.getElementById('gitalk-container'), loadGitalk)
  else loadGitalk()
} else {
  function loadOtherComment () {
    loadGitalk()
  }
}</script></div><div class="aplayer no-destroy" data-id="8611176905" data-server="netease" data-type="playlist" data-fixed="false" data-autoplay="false"> </div><script async data-pjax src="/js/random.js"></script><canvas class="fireworks" mobile="false"></canvas><script src="/pluginsSrc/butterfly-extsrc/dist/fireworks.min.js"></script><link rel="stylesheet" href="/pluginsSrc/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="/pluginsSrc/aplayer/dist/APlayer.min.js"></script><script src="/pluginsSrc/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>